---
title: "H2O Tutorial"
author: "Dol_R"
date: "8/30/2020"
output: 
  html_document:
    toc: true
    toc_depth: 3
---

## Introduction

`H2O` is a fully open source, distributed in-memory machine learning platform with linear scalability. H2O supports the most widely used statistical & machine learning algorithms including gradient boosted machines, generalized linear models, deep learning and more. H2O also has an industry leading AutoML functionality that automatically runs through all the algorithms and their hyperparameters to produce a leaderboard of the best models. The H2O platform is used by over 18,000 organizations globally and is extremely popular in both the R & Python communities.

##Leading Algorithms

Algorithms developed from the ground up for distributed computing and for both supervised and unsupervised approaches including Random Forest, GLM, GBM, XGBoost, GLRM, Word2Vec and many more.

## H2O Open Source AutoML

Train the best model in the least amount of time to save human hours.
Reduce the need for expertise in machine learning by reducing the manual code-writing time.
Improve the performance of machine learning models.
Increase reproducibility and establish a baseline for scientific research or applications.
Scales training data set to clusters (Hadoop, Spark, Kubernetes)



Normally we follow these steps:
- Data
- Train/Test Split
- Apply Model on Training Set
- Prediction on Test Set
- Accuracy

With H2O, we also need to initialize the package and convert data into H2O frame. 

## Setup: Install and Load the Library
First, copy the code in [h2o website](http://h2o-release.s3.amazonaws.com/h2o/rel-shannon/26/index.html#R) and paste into the console. 

```{r setup, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
#install one time only
#install.packages("h2o")
#install bit64, otherwise it gives an error
#install.packages('bit64', repos = "https://cran.rstudio.com")
library(bit64)
library(tidyverse)
library(ggplot2)
library(h2o)
## Initialize h2o cluster
h2o.init()
```

## Iris Data
Iris is a built-in dataset in R. It has 4 numerical independent variables and a categorical independent variable. Therefore this is a classification problem, not a regression.
This data has `r dim(iris)[1]` rows and `r dim(iris)[2]` columns. Dependent variable is `Species`.

```{r data}
data <- iris
glimpse(data)
data %>% count(Species)
```

```{r frame, results='hide'}
# Convert data to h2o frame
iris_data <- as.h2o(iris)
# Identify target and features
y <- "Species"
x <- setdiff(colnames(iris_data), y)
# For classification target should be a factor
iris_data[, y] <- as.factor(iris_data[, y])
```

```{r descb}
h2o.describe(iris_data)
```


### Train Test Split
```{r split}
# 80% train, 20% test
# Seed is defined in order to get the same result
split = h2o.splitFrame(data = iris_data, ratios = 0.8, seed=90)
train = split[[1]]
test = split[[2]]
```

### Model: gbm
```{r model, results='hide'}
# x=features, y=target
gbm_model <- h2o.gbm(x=x, y=y, training_frame = train, seed=90, family = "multinomial")
```

```{r perf,  warning=FALSE}
# Model's performance using test data, includes R^2 and confusion matrix
perf <- h2o.performance(gbm_model,test)
perf
```

### Model2: Random Forest
```{r model2, results='hide'}
# x=features, y=target
random_forest_model <- h2o.randomForest(x=c("Sepal.Length", "Sepal.Width", "Petal.Length", "Petal.Width"), y="Species", training_frame = train, seed=90)
```

```{r perf2}
# Model's performance using test data, includes R^2 and confusion matrix
perf2 <- h2o.performance(random_forest_model,test)
perf2
```

## Comparison of the Models
Let's look at confusion matrices for model predictions on test dataset. 
```{r comparison}
# Use confusion matrix
prediction_gbm = h2o.predict(gbm_model, test)
prediction_randomforest = h2o.predict(random_forest_model, test)
matrix_gbm = h2o.confusionMatrix(object=gbm_model, newdata=test$Species)
matrix_randomforest = h2o.confusionMatrix(object=random_forest_model, newdata=test$Species)

```




## Resources
- [Cran](https://cran.r-project.org/web/packages/h2o/index.html)
- [h2o.ai](http://docs.h2o.ai/h2o-tutorials/latest-stable/WhatIsH2O.html)
- [H2O Documentation](http://docs.h2o.ai/)
- [Kaggle](https://www.kaggle.com/mlg-ulb/creditcardfraud)
- [Generalized Linear Model(GLM)](https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html#)
- [Datacamp](https://campus.datacamp.com/courses/hyperparameter-tuning-in-r/hyperparameter-tuning-with-h2o?ex=1)
